<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>12ì¥ ì„ íƒ íƒ€ë¡œ</title>
  <style>
    :root{
      --bg:#0f0f14;
      --text:#f3f3f7;
      --muted:#b9b9c7;
      --panel:rgba(255,255,255,0.03);
      --border:rgba(255,255,255,0.08);
      --accent:#8a7dff;
      --good:#7cff6b;
      --warn:#ffd36b;
      --bad:#ff6b6b;
      --radius:16px;
      --cardRadius:18px;
      --cardW: min(22vw, 118px);
      --cardH: calc(var(--cardW) * 1.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background:radial-gradient(900px 600px at 50% 0%, #1c1b2d 0%, var(--bg) 55%);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 14px 28px;}
    .top{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px;
    }
    h1{font-size:18px; margin:0}
    .sub{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35}
    .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    button{
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    button:active{transform:translateY(1px)}
    button.primary{background:rgba(138,125,255,0.20); border-color:rgba(138,125,255,0.35)}
    button.danger{background:rgba(255,107,107,0.16); border-color:rgba(255,107,107,0.32)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.18);
      color:var(--muted); font-size:12px;
    }
    .pill b{color:var(--text)}
    .grid{display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px;}
    @media (min-width: 980px){
      .grid{grid-template-columns: 1.25fr .75fr;}
    }

    /* Left area */
    .board{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
    }
    .hint{margin:0 0 12px; color:var(--muted); font-size:13px; line-height:1.35}
    .cardGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      justify-items:center;
    }
    @media (min-width: 520px){
      .cardGrid{grid-template-columns: repeat(6, 1fr);}
    }

    .cardSlot{width:var(--cardW); height:var(--cardH); perspective:900px; position:relative;}
    .card{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition:transform .55s cubic-bezier(.2,.8,.2,1), filter .2s ease;
      border-radius:var(--cardRadius);
      cursor:pointer;
    }
    .card:hover{filter:brightness(1.06)}
    .card.flipped{transform:rotateY(180deg)}
    .face{
      position:absolute; inset:0;
      border-radius:var(--cardRadius);
      backface-visibility:hidden;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      box-shadow:0 14px 40px rgba(0,0,0,0.42);
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    .back{transform:rotateY(0deg)}
    .front{transform:rotateY(180deg)}
    .selectedGlow{
      outline:2px solid rgba(138,125,255,0.55);
      box-shadow:0 0 0 6px rgba(138,125,255,0.18), 0 18px 60px rgba(0,0,0,0.45);
    }

    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:14px;}
    .small{color:var(--muted); font-size:12px; margin:0}

    /* Right panel */
    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
    }
    .panel h2{margin:0 0 10px; font-size:16px}
    .result{
      padding:12px;
      border-radius:14px;
      background:rgba(0,0,0,0.20);
      border:1px solid rgba(255,255,255,0.08);
      min-height:220px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.05);
      width:fit-content;
    }
    .dot{width:8px; height:8px; border-radius:999px; background:var(--accent);}
    .k{margin:0; color:var(--muted); font-size:13px; line-height:1.45}
    .big{margin:0; font-size:16px; line-height:1.55}
    .box{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
    }
    .advice{
      border:1px dashed rgba(138,125,255,0.45);
      background:rgba(138,125,255,0.12);
      color:#ecebff;
      font-weight:900;
    }
    .dangerLine{border-color:rgba(255,107,107,0.38); background:rgba(255,107,107,0.10)}
    .divider{height:1px; background:rgba(255,255,255,0.08); margin:12px 0;}
    .history{display:flex; flex-direction:column; gap:8px; max-height:260px; overflow:auto; padding-right:4px;}
    .histItem{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      padding:10px 10px; border-radius:12px;
      background:rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.07);
    }
    .histItem small{color:var(--muted)}
    .histItem b{display:block; margin-bottom:4px}
    .miniBtn{padding:8px 10px; font-size:12px; border-radius:10px;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>ğŸ”® 12ì¥ ì„ íƒ íƒ€ë¡œ</h1>
      <p class="sub">12ì¥ì˜ ë’·ë©´ ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¥¼ ê³¨ë¼ íƒ­í•´ë´. ì„ íƒí•œ ì¹´ë“œë§Œ ë’¤ì§‘íˆê³ , ì˜¤ë¥¸ìª½ì— í•´ì„ì´ í’ë¶€í•˜ê²Œ ëœ¬ë‹¤.</p>
    </div>
    <div class="controls">
      <span class="pill">ëª¨ë“œ: <b id="modeLabel">ì˜¤ëŠ˜ì˜ í•œ ì¥</b></span>
      <button class="primary" id="btnToday">ì˜¤ëŠ˜ì˜ í•œ ì¥</button>
      <button id="btnFree">ììœ  ë½‘ê¸°</button>
      <button id="btnShuffle">ì¹´ë“œ ë‹¤ì‹œ ì„ê¸°</button>
      <button id="btnShare">ê²°ê³¼ ë³µì‚¬</button>
      <button class="danger" id="btnReset">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="grid">
    <!-- Left: 12 cards -->
    <div class="board">
      <p class="hint" id="hint">
        ì˜¤ëŠ˜ì˜ í•œ ì¥ ëª¨ë“œì—ì„œëŠ” â€œì˜¤ëŠ˜ í•˜ë£¨â€ ì¹´ë“œê°€ ê³ ì •ì´ì§€ë§Œ, <b>ì–´ëŠ ìœ„ì¹˜ì— ë†“ì¼ì§€ëŠ” ì„ì„ ë•Œë§ˆë‹¤ ë°”ë€ë‹¤</b>.
      </p>

      <div class="cardGrid" id="cardGrid"></div>

      <div class="row">
        <span class="pill">ì„ íƒ: <b id="pickedLabel">ì—†ìŒ</b></span>
        <span class="pill">ìƒíƒœ: <b id="stateLabel">ëŒ€ê¸°</b></span>
      </div>
      <p class="small">âœ… íŒ: ì¹œêµ¬ë“¤ì´ë‘ í•  ë• â€œììœ  ë½‘ê¸° + ì¹´ë“œ ë‹¤ì‹œ ì„ê¸°â€ë¡œ ëŒë¦¬ë©´ ì¤‘ë…ì„± ì˜¬ë¼ê°.</p>
    </div>

    <!-- Right: result -->
    <div class="panel">
      <h2>í•´ì„</h2>
      <div class="result" id="resultBox">
        <span class="badge"><span class="dot" id="toneDot"></span><span id="resTitle">ì•„ì§ ì„ íƒí•œ ì¹´ë“œê°€ ì—†ì–´</span></span>
        <p class="k" id="resKeywords">í‚¤ì›Œë“œ: â€”</p>

        <div class="box">
          <p class="k" style="margin:0 0 6px;">í•µì‹¬ í•´ì„</p>
          <p class="big" id="resCore">ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ í‘œì‹œë¼.</p>
        </div>

        <div class="box">
          <p class="k" style="margin:0 0 6px;">ì§€ê¸ˆ ìƒí™©ì—ì„œ ì´ë ‡ê²Œ ì½ì–´ë´</p>
          <p class="big" id="resContext">â€”</p>
        </div>

        <div class="box advice">
          <p class="k" style="margin:0 0 6px; color:#ecebff;">í•œ ì¤„ ì¡°ì–¸</p>
          <p class="big" id="resAdvice" style="margin:0;">â€”</p>
        </div>

        <div class="box dangerLine">
          <p class="k" style="margin:0 0 6px;">ê¸ˆê¸°/ì£¼ì˜</p>
          <p class="big" id="resWarn" style="margin:0;">â€”</p>
        </div>
      </div>

      <div class="divider"></div>
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h2 style="margin:0; font-size:16px;">ìµœê·¼ ê¸°ë¡</h2>
        <button class="miniBtn" id="btnClearHistory">ê¸°ë¡ ì§€ìš°ê¸°</button>
      </div>
      <div class="history" id="history"></div>

      <p class="small">âš ï¸ ì¬ë¯¸/ìê¸°ì„±ì°°ìš©. ì¤‘ìš”í•œ ê²°ì •ì€ í˜„ì‹¤ ì •ë³´ë„ ê°™ì´ í™•ì¸í•˜ì.</p>
    </div>
  </div>
</div>

<script>
  // ===== ì¹´ë“œ ë°ì´í„°(ì„¤ëª… í’ë¶€ ë²„ì „) =====
  const CARDS = [
    {
      id:"sun", name:"íƒœì–‘", icon:"ğŸŒ", img:"images/sun.png",
      keywords:["ì„±ê³µ","ê¸ì •","ëª…í™•í•¨","íšŒë³µ"],
      tone:"good",
      core:"íë¦„ì´ ë‹¹ì‹  í¸ìœ¼ë¡œ ê¸°ìš¸ê³  ìˆì–´ìš”. â€˜ì˜ ë˜ê³  ìˆëŠ” ê±¸ ë” ë°€ì–´ë„ ë˜ëŠ”â€™ ì¹´ë“œì…ë‹ˆë‹¤.",
      context:"ë§ì„¤ì„ì´ ì»¤ì§ˆìˆ˜ë¡ ê¸°íšŒê°€ í¬ë¯¸í•´ì ¸ìš”. ì§€ê¸ˆì€ ì •ë³´ê°€ ì¶©ë¶„í•˜ê³ , ì£¼ë³€ ë°˜ì‘ë„ ìš°í˜¸ì ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ì‘ì€ ê²°ì •ì„ ë¯¸ë£¨ê¸°ë³´ë‹¤ â€˜í•œ ë²ˆ ë” ì‹œë„â€™ê°€ ì„±ê³¼ë¡œ ì´ì–´ì§€ê¸° ì‰¬ì›Œìš”.",
      advice:"í•œ ë‹¨ê³„ë§Œ ë” ì•ìœ¼ë¡œ ê°€ì„¸ìš”. ê²°ê³¼ëŠ” ë”°ë¼ì˜µë‹ˆë‹¤.",
      warn:"ì™„ë²½ì£¼ì˜ë¡œ ì†ë„ë¥¼ ê¹ì§€ ë§ˆì„¸ìš”. â€˜ë” ì¤€ë¹„í•˜ê³ â€¦â€™ê°€ í•‘ê³„ê°€ ë˜ëŠ” ìˆœê°„ì´ ìˆìŠµë‹ˆë‹¤."
    },
    {
      id:"moon", name:"ë‹¬", icon:"ğŸŒ™", img:"images/moon.png",
      keywords:["ë¶ˆì•ˆ","ì˜¤í•´","ì°©ê°","ì ì¬"],
      tone:"warn",
      core:"ì§€ê¸ˆì€ ê°ì •ì´ ì‚¬ì‹¤ì„ ê°€ë¦¬ê³  ìˆì„ ìˆ˜ ìˆì–´ìš”. í™•ì •í•˜ê¸°ì—” ì•ˆê°œê°€ ë§ìŠµë‹ˆë‹¤.",
      context:"ìƒëŒ€ì˜ ë§/í–‰ë™ì„ ê³¼ëŒ€í•´ì„í•˜ê±°ë‚˜, ë°˜ëŒ€ë¡œ ì¤‘ìš”í•œ ì‹ í˜¸ë¥¼ ë†“ì¹˜ê¸° ì‰¬ìš´ êµ¬ê°„ì…ë‹ˆë‹¤. â€˜ëŠë‚Œâ€™ì´ ê°•í•˜ê²Œ ì˜¤ë”ë¼ë„ ë°ì´í„°(ëŒ€í™”/ë¬¸ì„œ/ì¼ì •/ì¦ê±°)ë¥¼ í•œ ë²ˆ ë” í™•ì¸í•˜ëŠ” ê²Œ ìœ ë¦¬í•´ìš”.",
      advice:"ì˜¤ëŠ˜ì€ ê²°ë¡  ë‚´ë¦¬ì§€ ë§ê³ , í™•ì¸ ì§ˆë¬¸ 1~2ê°œë§Œ ë˜ì§€ì„¸ìš”.",
      warn:"ìƒˆë²½ ê°ì •ê²°ì •(ì¶©ë™ ì—°ë½/í™• ì§ˆëŸ¬ë²„ë¦¬ê¸°)ì„ í”¼í•˜ì„¸ìš”. ë‚´ì¼ ë³´ë©´ í›„íšŒí•  í™•ë¥ ì´ í½ë‹ˆë‹¤."
    },
    {
      id:"lovers", name:"ì—°ì¸", icon:"â¤ï¸", img:"images/lovers.png",
      keywords:["ê´€ê³„","ì„ íƒ","í•©ì˜","ê°€ì¹˜"],
      tone:"good",
      core:"í•µì‹¬ì€ â€˜ë¬´ì—‡ì„ ì„ íƒí•˜ëŠëƒâ€™ì˜ˆìš”. ê´€ê³„ë“  ì¼ì´ë“ , ê°€ì¹˜ ê¸°ì¤€ì´ ë“œëŸ¬ë‚˜ëŠ” ì¹´ë“œì…ë‹ˆë‹¤.",
      context:"ì§€ê¸ˆì€ ëˆ„êµ°ê°€ì™€ì˜ â€˜í•©ì˜â€™ê°€ ì¤‘ìš”í•´ìš”. ë§ë¡œë§Œ ì¢‹ì•„ ë³´ì´ëŠ” ì„ íƒë³´ë‹¤, ì‹¤ì œë¡œ ì§€ì† ê°€ëŠ¥í•œ ì•½ì†/ê·œì¹™ì„ ë§Œë“œëŠ” ê²ƒì´ í¬ì¸íŠ¸ì…ë‹ˆë‹¤. ê°ì •ì´ í¬ë©´ í´ìˆ˜ë¡ ê¸°ì¤€ì„ ëª…í™•íˆ í•´ì•¼ ì˜¤ë˜ ê°‘ë‹ˆë‹¤.",
      advice:"ì¢‹ì€ ì„ íƒì€ â€˜ë‘˜ ë‹¤ í¸í•œ ê·œì¹™â€™ì„ ë§Œë“œëŠ” ê²ƒì—ì„œ ì‹œì‘í•´ìš”.",
      warn:"ìƒëŒ€ ëˆˆì¹˜ë§Œ ë³´ë©° ë‚˜ë¥¼ ë²„ë¦¬ëŠ” ì„ íƒì€ ë‚˜ì¤‘ì— í¬ê²Œ í„°ì§‘ë‹ˆë‹¤."
    },
    {
      id:"chariot", name:"ì „ì°¨", icon:"ğŸš—", img:"images/chariot.png",
      keywords:["ì¶”ì§„","ëŒíŒŒ","ìŠ¹ë¶€","ì‹¤í–‰"],
      tone:"good",
      core:"ì§€ê¸ˆì€ â€˜ê°€ì†â€™ì´ ë‹µì¸ êµ¬ê°„. ì¤€ë¹„ë³´ë‹¤ ì‹¤í–‰ì´ ë” í° ì´ë“ì„ ì¤ë‹ˆë‹¤.",
      context:"ìƒí™©ì´ ì™„ë²½í•´ì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©´ íƒ€ì´ë°ì„ ë†“ì¹  ìˆ˜ ìˆì–´ìš”. ì‘ì€ ì‹¤í–‰ì„ ì—°ì†ìœ¼ë¡œ ë¶™ì—¬ì„œ íë¦„ì„ ë§Œë“¤ë©´, ì£¼ë³€ì´ ë’¤ëŠ¦ê²Œ ë”°ë¼ì˜µë‹ˆë‹¤. íŠ¹íˆ ê²½ìŸ/ì…ì°°/ìŠ¹ë¶€ ìˆëŠ” ì¼ì— ê°•í•©ë‹ˆë‹¤.",
      advice:"ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” â€˜ê°€ì¥ ì‘ì€ ì‹¤í–‰ 1ê°œâ€™ë¥¼ ë°”ë¡œ í•˜ì„¸ìš”.",
      warn:"ì†ë„ì— ì·¨í•´ ì£¼ë³€ì„ ì¹˜ì§€ ì•Šê²Œâ€”ì†Œí†µ/ë³´ê³ /ì •ë¦¬(ê¸°ë¡)ë¥¼ ê°™ì´ ê°€ì ¸ê°€ì„¸ìš”."
    },
    {
      id:"tower", name:"íƒ‘", icon:"âš¡", img:"images/tower.png",
      keywords:["ê¸‰ë³€","ì¶©ê²©","ë¦¬ì…‹","ê°ì„±"],
      tone:"bad",
      core:"í”ë“¤ë¦¼ì´ ì˜¤ëŠ” ì¹´ë“œ. ë‹¤ë§Œ â€˜ë¬´ë„ˆì§ˆ ê±´ ë¬´ë„ˆì§€ê³  ìƒˆë¡œ ì„¸ìš¸ ê¸°íšŒâ€™ì´ê¸°ë„ í•´ìš”.",
      context:"ì˜ˆìƒ ë°– ë³€ìˆ˜(ì¼ì • ë³€ê²½/ê´€ê³„ ì¶©ëŒ/ê³„íš íŒŒíƒ„)ê°€ ë“¤ì–´ì˜¬ ìˆ˜ ìˆì–´ìš”. ì´ ì¹´ë“œì˜ í•µì‹¬ì€ â€˜í”¼í•˜ë ¤ë‹¤ ë” í¬ê²Œ ë§ì§€ ë§ê³ â€™, ë¹¨ë¦¬ ì¸ì •í•˜ê³  ì¬ë°°ì¹˜í•˜ëŠ” ê²ë‹ˆë‹¤. ë¶ˆí¸í•˜ì§€ë§Œ ì¥ê¸°ì ìœ¼ë¡œëŠ” ë…ì´ ë¹ ì§‘ë‹ˆë‹¤.",
      advice:"ë°©ì–´ë³´ë‹¤ ì¬ì •ë ¬. ìš°ì„ ìˆœìœ„ë¥¼ ë‹¤ì‹œ ì„¸ìš°ì„¸ìš”.",
      warn:"ê°ì •ì ìœ¼ë¡œ í­ë°œí•˜ê±°ë‚˜ â€˜ë‹¤ ì—ì–´ë²„ë¦¼â€™ì€ ì†í•´ê°€ í½ë‹ˆë‹¤. ì—ë”ë¼ë„ â€˜ì •ë¦¬í•˜ê³  ì—ê¸°â€™ê°€ ì •ë‹µ."
    },
    {
      id:"star", name:"ë³„", icon:"â­", img:"images/star.png",
      keywords:["í¬ë§","íšŒë³µ","ê°€ëŠ¥ì„±","íë§"],
      tone:"good",
      core:"ë‹¹ì¥ ì™„ë²½í•˜ì§„ ì•Šì•„ë„ â€˜ì¢‹ì•„ì§€ëŠ” ë°©í–¥â€™ì€ ì´ë¯¸ ì—´ë ¤ ìˆì–´ìš”.",
      context:"ì§€ì³ ìˆëŠ” ìƒíƒœì—ì„œ ìì£¼ ëœ¨ëŠ” ì¹´ë“œì…ë‹ˆë‹¤. ì§€ê¸ˆì€ â€˜ê³„ì† ë²„í‹°ëŠ” í˜â€™ë³´ë‹¤ â€˜íšŒë³µ ë£¨í‹´â€™ì´ ë” ì¤‘ìš”í•´ìš”. ì‘ì€ ì„±ì·¨ë¥¼ ìŒ“ìœ¼ë©´ ìš´ì´ ë”°ë¼ë¶™ìŠµë‹ˆë‹¤. ì‚¬ëŒ/ì •ë³´/ê¸°íšŒë„ ë‹¤ì‹œ ì—°ê²°ë  í™•ë¥ ì´ ë†’ì•„ìš”.",
      advice:"í•œ ë²ˆì— ë°”ê¾¸ì§€ ë§ê³ , ë§¤ì¼ 10%ì”©ë§Œ íšŒë³µí•˜ì„¸ìš”.",
      warn:"í¬ë§ì„ â€˜ê·¼ê±° ì—†ëŠ” ë‚™ê´€â€™ìœ¼ë¡œ ì°©ê°í•˜ì§€ ë§ê¸°. ì‘ì€ ì‹¤í–‰ì´ ìˆì–´ì•¼ ë³„ì´ í˜„ì‹¤ì´ ë©ë‹ˆë‹¤."
    },
    {
      id:"death", name:"ì£½ìŒ", icon:"â˜ ï¸", img:"images/death.png",
      keywords:["ì •ë¦¬","ì „í™˜","ìƒˆì¶œë°œ","ë‹¨ì ˆ"],
      tone:"warn",
      core:"ëì€ ë‚˜ì˜ì§€ ì•Šì•„ìš”. â€˜ì •ë¦¬í•´ì•¼ ë‹¤ìŒì´ ì—´ë¦°ë‹¤â€™ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤.",
      context:"ì§€ê¸ˆì€ ë­”ê°€ë¥¼ ê³„ì† ë¶™ì¡ì„ìˆ˜ë¡ ë¹„ìš©ì´ ì»¤ì§€ëŠ” êµ¬ê°„ì¼ ìˆ˜ ìˆì–´ìš”. ëŠì–´ì•¼ í•  ê²ƒ(ìŠµê´€/ê´€ê³„/í”„ë¡œì íŠ¸ ë²”ìœ„)ì„ ì •ë¦¬í•˜ë©´, ì˜¤íˆë ¤ ìƒˆ ì œì•ˆì´ ë“¤ì–´ì˜¬ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. â€˜ì„ íƒê³¼ ì§‘ì¤‘â€™ì´ í•µì‹¬.",
      advice:"ì •ë¦¬ ë¦¬ìŠ¤íŠ¸ 3ê°œë¥¼ ì“°ê³ , í•˜ë‚˜ë§Œ ë¨¼ì € ëŠì–´ë³´ì„¸ìš”.",
      warn:"ë¯¸ë ¨ ë•Œë¬¸ì— â€˜ë°˜ì¯¤ ì •ë¦¬â€™ë¡œ ì‹œê°„ì„ ëŒë©´ ì†í•´ê°€ ëˆ„ì ë©ë‹ˆë‹¤."
    },
    {
      id:"devil", name:"ì•…ë§ˆ", icon:"ğŸ˜ˆ", img:"images/devil.png",
      keywords:["ì§‘ì°©","ìœ í˜¹","ì¤‘ë…","ì˜ì¡´"],
      tone:"bad",
      core:"ì´ë¯¸ ì•Œê³  ìˆëŠ” â€˜ë‚˜ìœ ë°˜ë³µâ€™ì„ ëŠì„ íƒ€ì´ë°ì…ë‹ˆë‹¤.",
      context:"ê´€ê³„ë“  ì†Œë¹„ë“  ì—…ë¬´ë“ , â€œì´ê²Œ ë‚˜ë¥¼ ê°‰ì•„ë¨¹ëŠ”ë°ë„ ê³„ì†â€ í•˜ëŠ” íŒ¨í„´ì´ ìˆì–´ìš”. ì´ ì¹´ë“œëŠ” ë„ë• íŒë‹¨ì´ ì•„ë‹ˆë¼, êµ¬ì¡°ë¥¼ ë³´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. íŠ¸ë¦¬ê±°(ì–¸ì œ/ì™œ ë°˜ë³µë˜ëŠ”ì§€)ë¥¼ ì°¾ê³ , í™˜ê²½ì„ ë°”ê¾¸ëŠ” ê²Œ íš¨ê³¼ì ì´ì—ìš”.",
      advice:"ì˜ì§€ë¡œ ë²„í‹°ì§€ ë§ê³  â€˜í™˜ê²½â€™ì„ ë°”ê¾¸ì„¸ìš”(ì°¨ë‹¨/ê±°ë¦¬/ì‹œê°„ ì œí•œ).",
      warn:"ìƒëŒ€/ìƒí™© íƒ“ë§Œ í•˜ë©° ê³„ì† ë“¤ì–´ê°€ë©´ ë” ê¹Šê²Œ ë¹ ì§‘ë‹ˆë‹¤. ëŠëŠ” ê±´ â€˜ì§€ê¸ˆâ€™ì´ ì œì¼ ìŒ‰ë‹ˆë‹¤."
    },
    {
      id:"strength", name:"í˜", icon:"ğŸ¦", img:"images/strength.png",
      keywords:["ì¸ë‚´","ìì œ","íšŒë³µíƒ„ë ¥ì„±","ë©˜íƒˆ"],
      tone:"good",
      core:"ê°•í•¨ì€ í­ë°œì´ ì•„ë‹ˆë¼ â€˜ì¡°ì ˆâ€™ì…ë‹ˆë‹¤. ì¡°ìš©íˆ ì´ê¸°ëŠ” íë¦„.",
      context:"ì§€ê¸ˆì€ í¬ê²Œ ë­”ê°€ë¥¼ ë°”ê¾¸ê¸°ë³´ë‹¤, ë²„í‹°ë©´ì„œ ì¡°ì ˆí•˜ëŠ” ìª½ì´ ìŠ¹ë¥ ì´ ë†’ì•„ìš”. ë§/í‘œì •/ì†ë„ ì¡°ì ˆì„ í•˜ë©´ ìƒëŒ€ê°€ ë¨¼ì € ë¬´ë„ˆì§ˆ ìˆ˜ ìˆì–´ìš”. ì²´ë ¥, ìƒí™œ ë£¨í‹´ì´ ê²°ê³¼ë¥¼ ì¢Œìš°í•©ë‹ˆë‹¤.",
      advice:"í•œ ë²ˆì— í•´ê²°í•˜ë ¤ ë§ê³ , ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ë§Œí¼ë§Œ ë‹¨ë‹¨íˆ.",
      warn:"â€˜ì°¸ëŠ” ì²™â€™ í•˜ë‹¤ê°€ í•œ ë²ˆì— í„°ì§€ëŠ” ê²Œ ì œì¼ ìœ„í—˜. ê°ì • ë°°ì¶œ ë£¨íŠ¸ë¥¼ ë§Œë“¤ì–´ë‘ì„¸ìš”."
    },
    {
      id:"fool", name:"ë°”ë³´", icon:"ğŸ¤¡", img:"images/fool.png",
      keywords:["ì‹œì‘","ëª¨í—˜","ê°€ë²¼ì›€","ì²«ë°œ"],
      tone:"good",
      core:"ì™„ë²½í•œ ê³„íšë³´ë‹¤ â€˜ì²«ë°œâ€™ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì‹œì‘ ìš´ì´ ë¶™ëŠ” ì¹´ë“œì˜ˆìš”.",
      context:"ìƒˆë¡œìš´ ì‹œë„(í”„ë¡œì íŠ¸/ê´€ê³„/ì·¨ë¯¸/ì½˜í…ì¸ )ê°€ ì˜ ë§ëŠ” íƒ€ì´ë°ì…ë‹ˆë‹¤. ë‹¤ë§Œ â€˜ë„ˆë¬´ í° íŒâ€™ìœ¼ë¡œ ì‹œì‘í•˜ë©´ ë¶€ë‹´ì´ ì»¤ì ¸ìš”. ì‘ì€ ë²„ì „(MVP)ìœ¼ë¡œ ì‹œì‘í•´ì„œ, ë°˜ì‘ ë³´ê³  í‚¤ìš°ëŠ” ê²Œ ë² ìŠ¤íŠ¸.",
      advice:"ì§€ê¸ˆì€ â€˜ì‘ê²Œ ì‹œì‘í•´ì„œ ë¹ ë¥´ê²Œ ìˆ˜ì •â€™ì´ ì •ë‹µ.",
      warn:"ê·¼ê±° ì—†ëŠ” ìì‹ ê°ìœ¼ë¡œ ê³¼íˆ¬ì/ê³¼ì•½ì†ì€ ê¸ˆì§€. ê°€ë³ê²Œ ì‹œì‘í•˜ë˜, ê¸°ë¡ì€ ë‚¨ê¸°ì„¸ìš”."
    },
    {
      id:"justice", name:"ì •ì˜", icon:"âš–ï¸", img:"images/justice.png",
      keywords:["ê· í˜•","íŒë‹¨","ì±…ì„","ì •ì‚°"],
      tone:"warn",
      core:"ê°ì •ì´ ì•„ë‹ˆë¼ ê¸°ì¤€ìœ¼ë¡œ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì •ë¦¬/ì •ì‚°ì˜ ì¹´ë“œ.",
      context:"ê³„ì•½/ì—­í• /ëˆ/ì•½ì† ê°™ì´ â€˜ê¸°ì¤€ì´ í•„ìš”í•œâ€™ ìƒí™©ì—ì„œ ìì£¼ ë‚˜ì˜µë‹ˆë‹¤. ì§€ê¸ˆì€ ë§ë¡œ ì–¼ë²„ë¬´ë¦¬ê¸°ë³´ë‹¤ ë¬¸ì„œ/ê·œì¹™/ì •ì˜(ì •í™•í•œ í‘œí˜„)ê°€ í•„ìš”í•´ìš”. ê³µì •í•¨ì€ ê²°êµ­ ëŒì•„ì˜µë‹ˆë‹¤.",
      advice:"ê¸°ì¤€ì„ ë¬¸ì¥ìœ¼ë¡œ ì ì–´ë‘ê³  ê·¸ ê¸°ì¤€ëŒ€ë¡œë§Œ ì›€ì§ì´ì„¸ìš”.",
      warn:"í¸ë“¤ê¸°/ê°ì •íŒë‹¨ì€ ë‚˜ì¤‘ì— ë¶ˆë¦¬í•˜ê²Œ ëŒì•„ì˜¬ ìˆ˜ ìˆì–´ìš”."
    },
    {
      id:"hermit", name:"ì€ë‘”ì", icon:"ğŸ•¯ï¸", img:"images/hermit.png",
      keywords:["ë‚´ë©´","ê±°ë¦¬ë‘ê¸°","í†µì°°","ì •ë¦¬"],
      tone:"warn",
      core:"ì§€ê¸ˆì€ â€˜ì‚¬ëŒâ€™ë³´ë‹¤ â€˜ë‚˜â€™ë¥¼ ì •ë¦¬í•  ì‹œê°„ì´ í•„ìš”í•´ìš”.",
      context:"ì™¸ë¶€ ì†ŒìŒì´ ë§ì•„ì§ˆìˆ˜ë¡, í˜¼ì ìƒê°í•˜ëŠ” ì‹œê°„ì´ ë‹µì„ ì¤ë‹ˆë‹¤. ê¸‰í•œ ì—°ë½/ê²°ì •ì€ ì¤„ì´ê³ , ì •ë³´ë¥¼ ëª¨ì•„ ì •ë¦¬í•´ë³´ì„¸ìš”. í˜¼ì ìˆëŠ” ì‹œê°„ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì˜¤íˆë ¤ ëª…í™•í•´ì§‘ë‹ˆë‹¤.",
      advice:"ì˜¤ëŠ˜ì€ í˜¼ì 30ë¶„ë§Œ. ê·¸ ì•ˆì— ë‹µì´ ë‚˜ì˜µë‹ˆë‹¤.",
      warn:"ê³ ë¦½ì´ ê¸¸ì–´ì§€ë©´ ìš°ìš¸ë¡œ íë¥¼ ìˆ˜ ìˆì–´ìš”. â€˜í˜¼ì ì •ë¦¬ + í•„ìš”í•œ ì‚¬ëŒ 1ëª…ë§Œ ê³µìœ â€™ê°€ ê· í˜•."
    }
  ];

  const BACK_IMG = "images/back.png";

  // ===== ì €ì¥ í‚¤ =====
  const K = {
    mode: "tarot_pick_mode_v3",      // today | free
    todayPick: "tarot_today_pick_v3",// {date, cardId}
    history: "tarot_history_v3"      // [{ts, mode, cardId}]
  };

  const $ = (id)=>document.getElementById(id);
  const el = {
    modeLabel: $("modeLabel"),
    hint: $("hint"),
    cardGrid: $("cardGrid"),
    pickedLabel: $("pickedLabel"),
    stateLabel: $("stateLabel"),
    btnToday: $("btnToday"),
    btnFree: $("btnFree"),
    btnShuffle: $("btnShuffle"),
    btnShare: $("btnShare"),
    btnReset: $("btnReset"),
    btnClearHistory: $("btnClearHistory"),

    toneDot: $("toneDot"),
    resTitle: $("resTitle"),
    resKeywords: $("resKeywords"),
    resCore: $("resCore"),
    resContext: $("resContext"),
    resAdvice: $("resAdvice"),
    resWarn: $("resWarn"),

    history: $("history")
  };

  function loadJSON(key, fallback){
    try{ const raw=localStorage.getItem(key); return raw? JSON.parse(raw) : fallback; }
    catch{ return fallback; }
  }
  function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

  function fmtDate(d){
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  function nowLocal(){ return new Date(); }

  function byId(id){ return CARDS.find(c=>c.id===id); }

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function toneColor(tone){
    if(tone==="good") return getComputedStyle(document.documentElement).getPropertyValue("--good").trim();
    if(tone==="bad") return getComputedStyle(document.documentElement).getPropertyValue("--bad").trim();
    return getComputedStyle(document.documentElement).getPropertyValue("--warn").trim();
  }

  // ===== ê²Œì„ ìƒíƒœ =====
  let mode = localStorage.getItem(K.mode) || "today";
  let layout = [];           // 12ìŠ¬ë¡¯ì— ì–´ë–¤ ì¹´ë“œê°€ ê¹”ë ¤ìˆëŠ”ì§€ (cardId ë°°ì—´)
  let selectedIndex = null;  // ì–´ë–¤ ìŠ¬ë¡¯ì„ ëˆŒë €ëŠ”ì§€
  let revealed = false;      // í˜„ì¬ ì„ íƒ ì¹´ë“œê°€ ë’¤ì§‘í˜”ëŠ”ì§€
  let currentCardId = null;  // í˜„ì¬ ì„ íƒ ì¹´ë“œ id

  // today ëª¨ë“œ: ì¹´ë“œ ìì²´ëŠ” ê³ ì •, ìœ„ì¹˜ëŠ” ì„ê¸° í•  ë•Œë§ˆë‹¤ ë°”ë€œ
  function getTodayCardId(){
    const today = fmtDate(nowLocal());
    const saved = loadJSON(K.todayPick, null);
    if(saved && saved.date === today && saved.cardId) return saved.cardId;
    const id = shuffle(CARDS)[0].id;
    saveJSON(K.todayPick, { date: today, cardId: id });
    return id;
  }

  function buildLayout(){
    // layoutì€ í•­ìƒ 12ì¥ì˜ ì¹´ë“œë¡œ êµ¬ì„±(ì§€ê¸ˆì€ 12ì¥ë§Œ ìˆìœ¼ë¯€ë¡œ ì „ë¶€ ì‚¬ìš©)
    // ì˜¤ëŠ˜ ëª¨ë“œë©´ "ì˜¤ëŠ˜ ì¹´ë“œ"ëŠ” ê³ ì •ì´ì§€ë§Œ, ì„ì„ ë•Œë§ˆë‹¤ ìœ„ì¹˜ë§Œ ëœë¤
    const ids = CARDS.map(c=>c.id);
    const shuffled = shuffle(ids);

    if(mode === "today"){
      const todayId = getTodayCardId();
      // todayIdê°€ layout ì•ˆì— ë°˜ë“œì‹œ ì¡´ì¬(12ì¥ ì „ë¶€ë‹ˆê¹Œ ì¡´ì¬í•¨)
      // ê·¸ëƒ¥ ì„ì¸ ìƒíƒœ ê·¸ëŒ€ë¡œ ë‘ë©´ â€œì¹´ë“œ ê³ ì • + ìœ„ì¹˜ ëœë¤â€ì´ ë¨
      // (ì¦‰, ì˜¤ëŠ˜ ë½‘íˆëŠ” ì¹´ë“œê°€ ì–´ë–¤ ê±´ì§€ ì‚¬ìš©ìì—ê²ŒëŠ” ì„ íƒ í›„ì—ë§Œ ë“œëŸ¬ë‚¨)
      return shuffled;
    }
    // ììœ  ëª¨ë“œë„ ê·¸ëƒ¥ ì„ì–´ì„œ ë†“ê¸°
    return shuffled;
  }

  function setMode(m){
    mode = m;
    localStorage.setItem(K.mode, mode);
    el.modeLabel.textContent = (mode==="today") ? "ì˜¤ëŠ˜ì˜ í•œ ì¥" : "ììœ  ë½‘ê¸°";
    el.btnToday.classList.toggle("primary", mode==="today");
    el.btnFree.classList.toggle("primary", mode==="free");

    el.hint.innerHTML = (mode==="today")
      ? `ì˜¤ëŠ˜ì˜ í•œ ì¥ì€ ì¹´ë“œê°€ <b>í•˜ë£¨ ë™ì•ˆ ê³ ì •</b>ì´ì•¼. ëŒ€ì‹  ì¹´ë“œ ìœ„ì¹˜ëŠ” â€œì„ê¸°â€ë¡œ ë°”ë€ë‹¤.`
      : `ììœ  ë½‘ê¸°ëŠ” ë§¤ë²ˆ ê²°ê³¼ê°€ ë‹¬ë¼. ë§ˆìŒê» ì„ê³  ê³¨ë¼ë´.`;
  }

  function setResultEmpty(){
    el.toneDot.style.background = getComputedStyle(document.documentElement).getPropertyValue("--accent").trim();
    el.resTitle.textContent = "ì•„ì§ ì„ íƒí•œ ì¹´ë“œê°€ ì—†ì–´";
    el.resKeywords.textContent = "í‚¤ì›Œë“œ: â€”";
    el.resCore.textContent = "ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ í‘œì‹œë¼.";
    el.resContext.textContent = "â€”";
    el.resAdvice.textContent = "â€”";
    el.resWarn.textContent = "â€”";
    el.pickedLabel.textContent = "ì—†ìŒ";
    el.stateLabel.textContent = "ëŒ€ê¸°";
  }

  function setResult(card){
    el.toneDot.style.background = toneColor(card.tone);
    el.resTitle.textContent = `${card.name} ${card.icon}`;
    el.resKeywords.textContent = `í‚¤ì›Œë“œ: ${card.keywords.join(" Â· ")}`;
    el.resCore.textContent = card.core;
    el.resContext.textContent = card.context;
    el.resAdvice.textContent = card.advice;
    el.resWarn.textContent = card.warn;
    el.pickedLabel.textContent = `${card.name}`;
    el.stateLabel.textContent = revealed ? "ê³µê°œë¨" : "ì„ íƒë¨";
  }

  function pushHistory(cardId){
    const hist = loadJSON(K.history, []);
    hist.unshift({ ts: Date.now(), mode, cardId });
    saveJSON(K.history, hist.slice(0,50));
  }

  function renderHistory(){
    const hist = loadJSON(K.history, []);
    if(!hist.length){
      el.history.innerHTML = `<div class="k">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´. í•œ ë²ˆ ê³¨ë¼ë´!</div>`;
      return;
    }
    el.history.innerHTML = hist.slice(0,20).map(h=>{
      const c = byId(h.cardId);
      const dt = new Date(h.ts);
      return `
        <div class="histItem">
          <div>
            <b>${c.name} ${c.icon}</b>
            <small>${h.mode==="today" ? "ì˜¤ëŠ˜ì˜ í•œ ì¥" : "ììœ  ë½‘ê¸°"} Â· ${dt.toLocaleString()}</small>
          </div>
          <div style="display:flex; gap:8px;">
            <button class="miniBtn" data-open="${h.cardId}">ë³´ê¸°</button>
          </div>
        </div>
      `;
    }).join("");

    el.history.querySelectorAll("button[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-open");
        // ê¸°ë¡ì—ì„œ ì—´ëŒì€ â€œì„ íƒ ë³´ë“œâ€ì™€ëŠ” ë³„ê°œë¡œ ê·¸ëƒ¥ ê²°ê³¼ë§Œ ë³´ì—¬ì£¼ì
        const c = byId(id);
        revealed = true;
        currentCardId = id;
        setResult(c);
      });
    });
  }

  function renderBoard(){
    el.cardGrid.innerHTML = "";

    layout.forEach((cardId, idx)=>{
      const cardData = byId(cardId);

      const slot = document.createElement("div");
      slot.className = "cardSlot";

      const card = document.createElement("div");
      card.className = "card";

      // ì„ íƒí•œ ì¹´ë“œë§Œ ë’¤ì§‘ê¸° í‘œì‹œ
      const isSelected = (selectedIndex === idx);
      if(isSelected && revealed) card.classList.add("flipped");

      const back = document.createElement("div");
      back.className = "face back";
      back.style.backgroundImage = `url('${BACK_IMG}')`;

      const front = document.createElement("div");
      front.className = "face front";
      front.style.backgroundImage = `url('${cardData.img}')`;

      card.appendChild(back);
      card.appendChild(front);

      if(isSelected) card.classList.add("selectedGlow");

      card.addEventListener("click", ()=>{
        // 1) ì•„ì§ ì„ íƒ ì•ˆ í–ˆìœ¼ë©´ ì„ íƒë§Œ
        // 2) ì„ íƒ í›„ ë‹¤ì‹œ ëˆ„ë¥´ë©´ ë’¤ì§‘ê¸°(ê³µê°œ)
        // 3) ë‹¤ë¥¸ ì¹´ë“œ ëˆ„ë¥´ë©´ â€œì„ íƒ ë³€ê²½â€(ê³µê°œ ì „ê¹Œì§€ëŠ” ê°€ëŠ¥)
        if(selectedIndex === null){
          selectedIndex = idx;
          revealed = false;
          currentCardId = layout[idx];
          setResult(byId(currentCardId));
          renderBoard();
          return;
        }

        if(selectedIndex !== idx){
          // ê³µê°œ ì „ì´ë©´ ì„ íƒ ë³€ê²½ í—ˆìš© / ê³µê°œ í›„ì—ëŠ” ì„ íƒ ë³€ê²½ ë§‰ì•„ì„œ â€œìš´ëª… ê³ ì •â€ ëŠë‚Œ ì‚´ë¦¼
          if(revealed){
            // ì´ë¯¸ ê³µê°œëœ ìƒíƒœë©´, ë‹¤ë¥¸ ì¹´ë“œ ì„ íƒì€ ë§‰ê³  ì•ˆë‚´ë§Œ
            el.stateLabel.textContent = "ê³µê°œ ì™„ë£Œ(ë‹¤ì‹œ ì„ê¸° í•„ìš”)";
            return;
          }
          selectedIndex = idx;
          revealed = false;
          currentCardId = layout[idx];
          setResult(byId(currentCardId));
          renderBoard();
          return;
        }

        // ê°™ì€ ì¹´ë“œ ì¬í´ë¦­: ë’¤ì§‘ì–´ì„œ ê³µê°œ
        if(!revealed){
          revealed = true;
          currentCardId = layout[idx];
          setResult(byId(currentCardId));
          pushHistory(currentCardId);
          renderHistory();
          renderBoard();
        }else{
          // ê³µê°œ í›„ ì¬í´ë¦­ì€ ì•/ë’¤ í† ê¸€ ê°€ëŠ¥í•˜ê²Œ í•˜ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì„œ í† ê¸€ ì²˜ë¦¬ ê°€ëŠ¥
          // ì§€ê¸ˆì€ ê³µê°œ ìœ ì§€ë¡œ ë‘ì
        }
      });

      slot.appendChild(card);
      el.cardGrid.appendChild(slot);
    });
  }

  async function copyShare(){
    if(!currentCardId || !revealed){
      alert("ì¹´ë“œë¥¼ â€˜ê³µê°œ(ë’¤ì§‘ê¸°)â€™í•œ ë’¤ì— ê³µìœ í•  ìˆ˜ ìˆì–´!");
      return;
    }
    const c = byId(currentCardId);
    const m = (mode==="today") ? `ì˜¤ëŠ˜ì˜ í•œ ì¥(${fmtDate(nowLocal())})` : "ììœ  ë½‘ê¸°";
    const text =
`ğŸ”® ${m}
[${c.name} ${c.icon}]
í‚¤ì›Œë“œ: ${c.keywords.join(" Â· ")}
í•µì‹¬: ${c.core}
ìƒí™©: ${c.context}
ì¡°ì–¸: ${c.advice}
ì£¼ì˜: ${c.warn}`;
    try{
      await navigator.clipboard.writeText(text);
      el.btnShare.textContent = "ë³µì‚¬ ì™„ë£Œ!";
      setTimeout(()=> el.btnShare.textContent = "ê²°ê³¼ ë³µì‚¬", 900);
    }catch{
      prompt("ë³µì‚¬ê°€ ì•ˆ ë˜ë©´ ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ë³´ë‚´ì¤˜!", text);
    }
  }

  function resetSession(keepToday=false){
    selectedIndex = null;
    revealed = false;
    currentCardId = null;
    layout = buildLayout();
    setResultEmpty();
    renderBoard();

    // ì˜¤ëŠ˜ ëª¨ë“œì—ì„œ â€œì˜¤ëŠ˜ ì¹´ë“œ ìì²´ë¥¼ ë°”ê¾¸ê³  ì‹¶ì§€ ì•Šë‹¤ë©´â€ keepToday=trueë¡œ ì‚¬ìš©
    if(!keepToday && mode==="today"){
      // ì˜¤ëŠ˜ ì¹´ë“œ ìì²´ëŠ” ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥ë˜ë¯€ë¡œ êµ³ì´ ì§€ìš¸ í•„ìš” ì—†ì§€ë§Œ,
      // ì™„ì „ ì´ˆê¸°í™” ë²„íŠ¼ì—ì„œë§Œ ì§€ìš°ë„ë¡ ì²˜ë¦¬
    }
  }

  // ===== ë²„íŠ¼ ì´ë²¤íŠ¸ =====
  el.btnToday.addEventListener("click", ()=>{
    setMode("today");
    resetSession(true);
  });

  el.btnFree.addEventListener("click", ()=>{
    setMode("free");
    resetSession(true);
  });

  el.btnShuffle.addEventListener("click", ()=>{
    // ì„ê¸°: ì„ íƒ/ê³µê°œ ìƒíƒœ ì´ˆê¸°í™” + layout ì¬ìƒì„±
    resetSession(true);
    el.stateLabel.textContent = "ì„ìŒ";
  });

  el.btnShare.addEventListener("click", copyShare);

  el.btnClearHistory.addEventListener("click", ()=>{
    saveJSON(K.history, []);
    renderHistory();
  });

  el.btnReset.addEventListener("click", ()=>{
    localStorage.removeItem(K.mode);
    localStorage.removeItem(K.todayPick);
    localStorage.removeItem(K.history);
    setMode("today");
    resetSession(true);
    renderHistory();
  });

  // ===== ì‹œì‘ =====
  setMode(mode);
  renderHistory();
  resetSession(true);
</script>
</body>
</html>
